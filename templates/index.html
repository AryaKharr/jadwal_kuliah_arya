<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Kuliah - Semester Genap 2025/2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>üìö‚ú® Jadwal Kuliah</h1>
            <p class="subtitle">Semester Genap 2025/2026 ‚Ä¢ Tracking Tugas Mahasiswa</p>
        </header>

        <div class="table-responsive">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>üìÖ Hari</th>
                        <th>‚è∞ Pukul</th>
                        <th>üìñ Mata Kuliah</th>
                        <th>üè¢ Ruang</th>
                        <th>‚úÖ Tugas Aktif</th>
                        <th>‚ö° Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in jadwal %}
                    <tr class="schedule-row"
                        onclick="openModal({{ item.id }}, '{{ item.hari }}', '{{ item.jam }}', '{{ item.matkul }}', '{{ item.ruang }}', {{ item.deskripsi | tojson }})">
                        <td class="cell-hari" data-label="üìÖ Hari"><span class="badge">{{ item.hari }}</span></td>
                        <td class="cell-jam" data-label="‚è∞ Jam">{{ item.jam }}</td>
                        <td class="cell-matkul" data-label="üìñ Matkul"><a href="/matkul/{{ item.id }}"
                                class="matkul-link" onclick="event.stopPropagation()">{{ item.matkul }}</a></td>
                        <td class="cell-ruang" data-label="üè¢ Ruang">{{ item.ruang }}</td>
                        <td class="cell-tugas" data-label="‚úÖ Tugas">
                            {% if item.tugas %}
                            <ul class="tugas-list">
                                {% for t in item.tugas %}
                                <li class="tugas-item" onclick="event.stopPropagation();">
                                    <span>‚úì {{ t.nama }}</span>
                                    <form action="/hapus_tugas" method="POST" class="form-hapus"
                                        onsubmit="return confirm('Hapus tugas ini?')">
                                        <input type="hidden" name="tugas_id" value="{{ t.id }}">
                                        <button type="submit" class="btn-hapus" title="Hapus">‚úï</button>
                                    </form>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <span class="empty-state">‚Äî Belum ada tugas ‚Äî</span>
                            {% endif %}
                        </td>
                        <td class="cell-aksi" data-label="‚ö° Aksi" onclick="event.stopPropagation();">
                            <form action="/tambah_tugas" method="POST" class="form-tambah">
                                <input type="hidden" name="matkul_id" value="{{ item.id }}">
                                <div class="input-group">
                                    <input type="text" name="tugas" placeholder="Tugas baru..." required>
                                    <button type="submit" class="btn-tambah" title="Tambah Tugas">+</button>
                                </div>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <footer>
            <p>‚ù§Ô∏è Dibuat dengan passion untuk memudahkan tracking tugas kuliah mahasiswa</p>
        </footer>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="detail-item">
                    <span class="detail-label">üìñ Deskripsi Mata Kuliah</span>
                    <p id="modalDeskripsi" class="modal-deskripsi"></p>
                </div>
                <div class="detail-item">
                    <span class="detail-label">üìÖ Hari Kuliah</span>
                    <span id="modalHari"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">‚è∞ Waktu Kuliah</span>
                    <span id="modalJam"></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">üè¢ Lokasi</span>
                    <span id="modalRuang"></span>
                </div>
                <div class="detail-item tugas-section">
                    <span class="detail-label">‚úÖ Daftar Tugas</span>
                    <div id="modalTugasList" class="modal-tugas-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openModal(id, hari, jam, matkul, ruang, deskripsi) {
            document.getElementById('modalTitle').textContent = matkul;
            document.getElementById('modalHari').textContent = hari;
            document.getElementById('modalJam').textContent = jam;
            document.getElementById('modalRuang').textContent = ruang;
            document.getElementById('modalDeskripsi').textContent = deskripsi;

            // Get tugas list from the table row
            const row = event.currentTarget;
            const tugasCell = row.querySelector('.cell-tugas');
            const tugasList = tugasCell.querySelector('.tugas-list');

            const modalTugasList = document.getElementById('modalTugasList');

            if (tugasList) {
                const tugas = Array.from(tugasList.querySelectorAll('.tugas-item')).map(li => {
                    const form = li.querySelector('form');
                    const tugasId = form.querySelector('input[name="tugas_id"]').value;
                    return { name: li.querySelector('span').textContent.replace('‚úì ', ''), id: tugasId };
                });

                if (tugas.length > 0) {
                    modalTugasList.innerHTML = tugas.map((t) =>
                        `<div class="modal-tugas-item">
                            <span>‚úì ${t.name}</span>
                            <form action="/hapus_tugas" method="POST" class="form-hapus-modal" onsubmit="return confirm('Hapus tugas ini?')">
                                <input type="hidden" name="tugas_id" value="${t.id}">
                                <button type="submit" class="btn-hapus-modal" title="Hapus">‚úï</button>
                            </form>
                        </div>`
                    ).join('');
                } else {
                    modalTugasList.innerHTML = '<p class="modal-empty">Tidak ada tugas untuk mata kuliah ini</p>';
                }
            } else {
                modalTugasList.innerHTML = '<p class="modal-empty">Tidak ada tugas untuk mata kuliah ini</p>';
            }

            document.getElementById('detailModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>

</html>